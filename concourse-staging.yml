networks:
- name: concourse
  subnets:
  - range: (( grab terraform_outputs.staging_concourse_subnet_cidr ))
    gateway: (( grab terraform_outputs.staging_concourse_subnet_gateway ))
    cloud_properties:
      subnet: (( grab terraform_outputs.staging_concourse_subnet ))
      security_groups:
      - (( grab terraform_outputs.staging_concourse_security_group ))
      - (( grab terraform_outputs.bosh_security_group ))

resource_pools:
- name: web
  cloud_properties:
    elbs:
    - (( grab terraform_outputs.staging_concourse_elb_name ))
- name: workers
  cloud_properties:
    iam_instance_profile: (( grab terraform_outputs.concourse_worker_profile ))

instance_groups:
- name: web
  jobs:
  - name: atc
    properties:
      postgresql:
        database: (( grab terraform_outputs.staging_concourse_rds_name ))
        host: (( grab terraform_outputs.staging_concourse_rds_url ))
        role:
          name: (( grab terraform_outputs.staging_concourse_rds_username ))
          password: (( grab terraform_outputs.staging_concourse_rds_password ))
  - name: riemann-emitter
    properties:
      riemann_emitter:
        rds:
          access_key_id: (( grab terraform_outputs.awslogs_access_key_id_curr ))
          secret_access_key: (( grab terraform_outputs.awslogs_secret_access_key_curr ))
          instance_name: (( grab terraform_outputs.staging_concourse_rds_identifier ))
          region: (( grab meta.rds.region ))
